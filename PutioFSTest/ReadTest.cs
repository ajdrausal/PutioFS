
using System;
using System.Text;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Diagnostics;
using System.Threading;
using Microsoft.VisualStudio.TestTools.UnitTesting;

using PutioFS.Core;

namespace PutioFS.Test
{


    [TestClass]
    public class PutioFileRead
    {
        public static string test_url = @"file://C:/Users/firat/ApacheRoot/660.avi";
        public static string test_local_file = @"C:/Users/firat/ApacheRoot/660.avi";

        [TestMethod]
        public void PutioFileReadTest()
        {
            FileInfo finfo = new FileInfo(test_local_file);
            PutioFile remote_file = new PutioFile(new PutioFsTestDataProvider(finfo.Name, finfo.FullName, 660, finfo.Length, false, Constants.LocalStoragePath), null);
            PutioFileHandle remote_stream = remote_file.Open();
            //FileStream remote_stream = File.Open(remote_file.DataProvider.LocalStorageFile, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);
            FileStream local_stream = File.Open(test_local_file, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);

            byte[] local_data = new byte[11952];
            byte[] remote_data = new byte[11952];

            local_stream.Seek(367043856, SeekOrigin.Begin);
            local_stream.Read(local_data, 0, local_data.Length);
            // remote_stream.Seek(367043856, SeekOrigin.Begin);
            remote_stream.Seek(367043856);
            remote_stream.Read(remote_data, 0, remote_data.Length);


            CollectionAssert.AreEqual(local_data, remote_data);
        }

        [TestMethod]
        public void PutioFileVLCReadTest()
        {
            PutioFile remote_file = new PutioFile(new PutioFsTestDataProvider("660.avi", test_local_file, 660, 697080622, false, Constants.LocalStoragePath), null);
            PutioFileHandle remote_stream = remote_file.Open();
            FileStream local_stream = File.Open(test_local_file, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);

            foreach(int[] p in vlc_read_positions)
            {
                byte[] local_data = new byte[p[0]];
                byte[] remote_data = new byte[p[0]];

                remote_stream.Seek(p[1]);
                int remote_read = remote_stream.Read(remote_data, 0, p[0]);
                local_stream.Seek(p[1], SeekOrigin.Begin);
                int local_read = local_stream.Read(local_data, 0, p[0]);

                Assert.AreEqual(local_read, remote_read);
                CollectionAssert.AreEqual(remote_data, local_data);
            }
            Debug.WriteLine(":(");
        }

        public static int[][] vlc_read_positions = new int[][] {
            new int[]{1024, 0},
            new int[]{2, 524288},
            new int[]{512, 1024},
            new int[]{512, 4340},
            new int[]{512, 4852},
            new int[]{512, 8582},
            new int[]{512, 9094},
            new int[]{512, 9606},
            new int[]{1024, 0},
            new int[]{512, 10118},
            new int[]{512, 1024},
            new int[]{512, 364803248},
            new int[]{512, 4340},
            new int[]{10240, 364803760},
            new int[]{512, 4852},
            new int[]{10240, 364814000},
            new int[]{512, 8582},
            new int[]{10240, 364824240},
            new int[]{512, 9094},
            new int[]{10240, 364834480},
            new int[]{512, 9606},
            new int[]{10240, 364844720},
            new int[]{512, 10118},
            new int[]{10240, 364854960},
            new int[]{512, 364803248},
            new int[]{10240, 364865200},
            new int[]{10240, 364803760},
            new int[]{10240, 364814000},
            new int[]{10240, 364824240},
            new int[]{10240, 364875440},
            new int[]{10240, 364834480},
            new int[]{10240, 364885680},
            new int[]{10240, 364844720},
            new int[]{8528, 364895920},
            new int[]{10240, 364854960},
            new int[]{1712, 364904448},
            new int[]{10240, 364865200},
            new int[]{10240, 364906160},
            new int[]{11952, 364916400},
            new int[]{11952, 364928352},
            new int[]{10240, 364875440},
            new int[]{11952, 364940304},
            new int[]{10240, 364885680},
            new int[]{11952, 364952256},
            new int[]{8528, 364895920},
            new int[]{11952, 364964208},
            new int[]{1712, 364904448},
            new int[]{11952, 364976160},
            new int[]{10240, 364906160},
            new int[]{11952, 364988112},
            new int[]{11952, 364916400},
            new int[]{11952, 365000064},
            new int[]{11952, 364928352},
            new int[]{11952, 365012016},
            new int[]{11952, 364940304},
            new int[]{11952, 365023968},
            new int[]{11952, 364952256},
            new int[]{11952, 365035920},
            new int[]{11952, 364964208},
            new int[]{11952, 364976160},
            new int[]{11952, 365047872},
            new int[]{11952, 364988112},
            new int[]{11952, 365059824},
            new int[]{11952, 365000064},
            new int[]{11952, 365071776},
            new int[]{11952, 365012016},
            new int[]{11952, 365083728},
            new int[]{11952, 365023968},
            new int[]{11952, 365095680},
            new int[]{11952, 365035920},
            new int[]{11952, 365107632},
            new int[]{11952, 365047872},
            new int[]{11952, 365119584},
            new int[]{11952, 365059824},
            new int[]{11952, 365131536},
            new int[]{11952, 365071776},
            new int[]{11952, 365143488},
            new int[]{11952, 365083728},
            new int[]{11952, 365155440},
            new int[]{11952, 365095680},
            new int[]{11952, 365167392},
            new int[]{11952, 365107632},
            new int[]{11952, 365179344},
            new int[]{11952, 365119584},
            new int[]{11952, 365191296},
            new int[]{11952, 365131536},
            new int[]{11952, 365203248},
            new int[]{11952, 365143488},
            new int[]{11952, 365215200},
            new int[]{11952, 365155440},
            new int[]{11952, 365227152},
            new int[]{11952, 365167392},
            new int[]{11952, 365239104},
            new int[]{11952, 365179344},
            new int[]{11952, 365251056},
            new int[]{11952, 365191296},
            new int[]{11952, 365263008},
            new int[]{11952, 365203248},
            new int[]{11952, 365274960},
            new int[]{11952, 365286912},
            new int[]{11952, 365215200},
            new int[]{11952, 365298864},
            new int[]{11952, 365227152},
            new int[]{11952, 365310816},
            new int[]{11952, 365239104},
            new int[]{11952, 365322768},
            new int[]{11952, 365251056},
            new int[]{11952, 365334720},
            new int[]{11952, 365263008},
            new int[]{11952, 366004032},
            new int[]{11952, 365956224},
            new int[]{11952, 366015984},
            new int[]{11952, 365968176},
            new int[]{11952, 366027936},
            new int[]{11952, 365980128},
            new int[]{11952, 366039888},
            new int[]{11952, 365992080},
            new int[]{11952, 366051840},
            new int[]{11952, 366063792},
            new int[]{11952, 366004032},
            new int[]{11952, 366075744},
            new int[]{11952, 366015984},
            new int[]{11952, 366087696},
            new int[]{11952, 366027936},
            new int[]{11952, 366099648},
            new int[]{11952, 366039888},
            new int[]{11952, 366111600},
            new int[]{11952, 366051840},
            new int[]{11952, 366123552},
            new int[]{11952, 366063792},
            new int[]{11952, 366135504},
            new int[]{11952, 366075744},
            new int[]{11952, 366147456},
            new int[]{11952, 366087696},
            new int[]{11952, 366159408},
            new int[]{11952, 366099648},
            new int[]{11952, 366171360},
            new int[]{11952, 366111600},
            new int[]{11952, 366183312},
            new int[]{11952, 366123552},
            new int[]{11952, 366195264},
            new int[]{11952, 366135504},
            new int[]{11952, 366207216},
            new int[]{11952, 366147456},
            new int[]{11952, 366219168},
            new int[]{11952, 366159408},
            new int[]{11952, 366231120},
            new int[]{11952, 366171360},
            new int[]{11952, 366243072},
            new int[]{11952, 366183312},
            new int[]{11952, 366255024},
            new int[]{11952, 366266976},
            new int[]{11952, 366278928},
            new int[]{11952, 366195264},
            new int[]{11952, 366290880},
            new int[]{11952, 366207216},
            new int[]{11952, 366302832},
            new int[]{11952, 366219168},
            new int[]{11952, 366314784},
            new int[]{11952, 366231120},
            new int[]{11952, 366326736},
            new int[]{11952, 366243072},
            new int[]{11952, 366338688},
            new int[]{11952, 366255024},
            new int[]{11952, 366350640},
            new int[]{11952, 366266976},
            new int[]{11952, 366362592},
            new int[]{11952, 366278928},
            new int[]{11952, 366374544},
            new int[]{11952, 366290880},
            new int[]{11952, 366302832},
            new int[]{11952, 366314784},
            new int[]{11952, 366386496},
            new int[]{11952, 366326736},
            new int[]{11952, 366398448},
            new int[]{11952, 366338688},
            new int[]{11952, 366410400},
            new int[]{11952, 366350640},
            new int[]{11952, 366422352},
            new int[]{11952, 366362592},
            new int[]{11952, 366434304},
            new int[]{11952, 366374544},
            new int[]{11952, 366446256},
            new int[]{11952, 366458208},
            new int[]{11952, 366470160},
            new int[]{11952, 366386496},
            new int[]{11952, 366482112},
            new int[]{11952, 366398448},
            new int[]{11952, 366494064},
            new int[]{11952, 366410400},
            new int[]{11952, 366506016},
            new int[]{11952, 366422352},
            new int[]{11952, 366517968},
            new int[]{11952, 366434304},
            new int[]{11952, 366529920},
            new int[]{11952, 366446256},
            new int[]{11952, 366541872},
            new int[]{11952, 366458208},
            new int[]{11952, 366553824},
            new int[]{11952, 366470160},
            new int[]{11952, 366565776},
            new int[]{11952, 366482112},
            new int[]{11952, 366494064},
            new int[]{11952, 366506016},
            new int[]{11952, 366577728},
            new int[]{11952, 366517968},
            new int[]{11952, 366589680},
            new int[]{11952, 366529920},
            new int[]{11952, 366601632},
            new int[]{11952, 366541872},
            new int[]{11952, 366613584},
            new int[]{11952, 366553824},
            new int[]{11952, 366625536},
            new int[]{11952, 366565776},
            new int[]{11952, 366637488},
            new int[]{11952, 366649440},
            new int[]{11952, 366661392},
            new int[]{11952, 366577728},
            new int[]{11952, 366673344},
            new int[]{11952, 366589680},
            new int[]{11952, 366685296},
            new int[]{11952, 366601632},
            new int[]{11952, 366697248},
            new int[]{11952, 366613584},
            new int[]{11952, 366709200},
            new int[]{11952, 366625536},
            new int[]{11952, 366721152},
            new int[]{11952, 366637488},
            new int[]{11952, 366733104},
            new int[]{11952, 366649440},
            new int[]{11952, 366745056},
            new int[]{11952, 366661392},
            new int[]{11952, 366757008},
            new int[]{11952, 366673344},
            new int[]{11952, 366685296},
            new int[]{11952, 366697248},
            new int[]{11952, 366768960},
            new int[]{11952, 366709200},
            new int[]{11952, 366780912},
            new int[]{11952, 366721152},
            new int[]{11952, 366792864},
            new int[]{11952, 366733104},
            new int[]{11952, 366804816},
            new int[]{11952, 366745056},
            new int[]{11952, 366816768},
            new int[]{11952, 366757008},
            new int[]{11952, 366828720},
            new int[]{11952, 366840672},
            new int[]{11952, 366768960},
            new int[]{11952, 366852624},
            new int[]{11952, 366780912},
            new int[]{11952, 366864576},
            new int[]{11952, 366792864},
            new int[]{11952, 366876528},
            new int[]{11952, 366804816},
            new int[]{11952, 366888480},
            new int[]{11952, 366816768},
            new int[]{11952, 366900432},
            new int[]{11952, 366828720},
            new int[]{11952, 366912384},
            new int[]{11952, 366840672},
            new int[]{11952, 366924336},
            new int[]{11952, 366852624},
            new int[]{11952, 366936288},
            new int[]{11952, 366864576},
            new int[]{11952, 366948240},
            new int[]{11952, 366876528},
            new int[]{11952, 366888480},
            new int[]{11952, 366960192},
            new int[]{11952, 366900432},
            new int[]{11952, 366972144},
            new int[]{11952, 366912384},
            new int[]{11952, 366984096},
            new int[]{11952, 366924336},
            new int[]{11952, 366996048},
            new int[]{11952, 366936288},
            new int[]{11952, 367008000},
            new int[]{11952, 366948240},
            new int[]{11952, 367019952},
            new int[]{11952, 367031904},
            new int[]{11952, 366960192},
            new int[]{11952, 367043856},
            new int[]{11952, 366972144},
            new int[]{11952, 367055808},
            new int[]{11952, 366984096},
            new int[]{11952, 367067760},
            new int[]{11952, 366996048},
            new int[]{11952, 367079712},
            new int[]{11952, 367008000},
            new int[]{11952, 367091664},
            new int[]{11952, 367019952},
            new int[]{11952, 367103616},
            new int[]{11952, 367031904},
            new int[]{11952, 367115568},
            new int[]{11952, 367043856},
            new int[]{11952, 367127520},
            new int[]{11952, 367055808},
            new int[]{11952, 367139472},
            new int[]{11952, 367067760},
            new int[]{11952, 367079712},
            new int[]{11952, 367091664},
            new int[]{11952, 367151424},
            new int[]{11952, 367103616},
            new int[]{11952, 367163376},
            new int[]{11952, 367115568},
            new int[]{11952, 367175328},
            new int[]{11952, 367127520},
            new int[]{11952, 367187280},
            new int[]{11952, 367139472},
            new int[]{11952, 367199232},
            new int[]{11952, 367211184},
            new int[]{11952, 367223136},
            new int[]{11952, 367151424},
            new int[]{11952, 367235088},
            new int[]{11952, 367163376},
            new int[]{11952, 367247040},
            new int[]{11952, 367175328},
            new int[]{11952, 367258992},
            new int[]{11952, 367187280},
            new int[]{11952, 367270944},
            new int[]{11952, 367199232},
            new int[]{11952, 367282896},
            new int[]{11952, 367211184},
            new int[]{11952, 367294848},
            new int[]{11952, 367223136},
            new int[]{11952, 367306800},
            new int[]{11952, 367235088},
            new int[]{11952, 367318752},
            new int[]{11952, 367247040},
            new int[]{11952, 367330704},
            new int[]{11952, 367258992},
            new int[]{11952, 367270944},
            new int[]{11952, 367282896},
            new int[]{11952, 367342656},
            new int[]{11952, 367294848},
            new int[]{11952, 367354608},
            new int[]{11952, 367306800},
            new int[]{11952, 367366560},
            new int[]{11952, 367318752},
            new int[]{11952, 367378512},
            new int[]{11952, 367330704},
            new int[]{11952, 367390464},
            new int[]{11952, 367402416},
            new int[]{11952, 367414368},
            new int[]{11952, 367342656},
            new int[]{11952, 367426320},
            new int[]{11952, 367354608},
            new int[]{11952, 367438272},
            new int[]{11952, 367366560},
            new int[]{11952, 367450224},
            new int[]{11952, 367378512},
            new int[]{11952, 367462176},
            new int[]{11952, 367390464},
            new int[]{11952, 367474128},
            new int[]{11952, 367402416},
            new int[]{11952, 367486080},
            new int[]{11952, 367414368},
            new int[]{11952, 367498032},
            new int[]{11952, 367426320},
            new int[]{11952, 367509984},
            new int[]{11952, 367438272},
            new int[]{11952, 367521936},
            new int[]{11952, 367450224},
            new int[]{11952, 367533888},
            new int[]{11952, 367462176},
            new int[]{11952, 367545840},
            new int[]{11952, 367474128},
            new int[]{11952, 367557792},
            new int[]{11952, 367486080},
            new int[]{11952, 367569744},
            new int[]{11952, 367498032},
            new int[]{11952, 367581696},
            new int[]{11952, 367509984},
            new int[]{2440, 367591208},
            new int[]{11952, 367521936},
            new int[]{11952, 367591208},
            new int[]{11952, 367533888},
            new int[]{11952, 367545840},
            new int[]{11952, 367557792},
            new int[]{11952, 367569744},
            new int[]{11952, 367581696},
            new int[]{2440, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 10630},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208},
            new int[]{11952, 367591208}
        };

    }
}
